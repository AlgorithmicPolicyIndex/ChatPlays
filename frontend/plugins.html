<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Title</title>
	<link id="css" rel="stylesheet" href="./controlpanel.css">
</head>
<body>
<ul class="plugins" style="list-style-type: none;"></ul>
</body>
<style>
.buttons {
	margin-top: 10px;
	display: flex;
	align-items: center;
	justify-content: center;
}
button {
	margin-left: 5px;
}
</style>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
<script>
	window.electron.getPlugins((pluginData, Settings) => {
                const plugins = JSON.parse(pluginData);

                const ul = $('.plugins');
	        for (const plugin of plugins) {
			const li = $('<li></li>');
			const div = $(`<div class="plugin"><h2>${plugin.name} - ${String(plugin.type).charAt(0).toUpperCase() + String(plugin.type).slice(1)}</h2></div>`);
			const info = $(`<div class="info">Description: ${plugin.description}<br>Author: ${plugin.author}</div>`);
			const buttons = $('<div class="buttons">');
			// TODO: Handle auto disabler for buttons
			const enable = $(`<button class='enable'>Enable</button>`);
			const disable = $("<button class='disable' disabled>Disable</button>");
		        const configure = $(`<button class='configure'>Configure</button>`);

			const exists = Settings.Plugins.find(p => p.name === plugin.name);
			if (exists) {
				enable.prop('disabled', true);
				disable.prop('disabled', false);
			}

			if (!plugin.options.configurable) configure.prop("disabled", true);

			div.data("info", plugin);
			div.append(info).append(buttons.append([enable, disable, configure]));
			ul.append(li.append(div));
	        }
	});

	$(".plugins")
	.on("click", ".enable", function () {
		const plugin = $(this).closest(".plugin");
		plugin.find(".enable").prop("disabled", true);
		plugin.find(".disable").prop("disabled", false);

		window.electron.handlePlugin(
			"enable",
			plugin.data("info")
		);
	})
	.on("click", ".disable", function () {
		const plugin = $(this).closest(".plugin");
		plugin.find(".enable").prop("disabled", false);
		plugin.find(".disable").prop("disabled", true);

		window.electron.handlePlugin(
			"disable",
			plugin.data("info")
		);
	})
	.on("click", ".configure", function () {
		const plugin = $(this).closest(".plugin");
		window.electron.handlePlugin(
			"configure",
			plugin.data("info")
		);
	});
</script>
</html>