<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
</head>
<body>
    <div id="winamp" style="height: 100vh;"></div>
</body>
<script type="module">
    import Webamp from "https://unpkg.com/webamp@^2/lazy";
    const webamp = new Webamp({
        windowLayout: {
            main: {
                position: { top: 0, left: 0 },
                shadeMode: false,
                closed: false
            },
        },
        enableDoubleSizeMode: true,
    });

    setInterval(() => {
            window.electron.requestMusic();
    }, 1500);

    let paused = false;
    webamp.renderWhenReady(document.getElementById("winamp")).then(() => {
        // Initial Grab
        window.electron.requestMusic();

        window.electron.getMusic(parsed => {
            if (parsed === "np" && !paused) {
                paused = true;
                return webamp.pause();
            }

            const state = webamp.store.getState();
            if (state.playlist.currentTrack !== null && parsed.Title === state.tracks[state.playlist.currentTrack].title)
                if (paused) {
                    paused = false;
                    return webamp.play();
                } else return;

            if (paused && parsed === "np")
                return;

            webamp.appendTracks([{
                url: parsed.audioURL,
                defaultName: `${parsed.Author} - ${parsed.Title}`,
                metaData: {
                    artist: parsed.Author,
                    title: parsed.Title,
                },
                duration: Math.ceil(parsed.Position[1]/1000),
            }]);
            webamp.nextTrack();
            webamp.play();
        });
    });
</script>
<style>
    html, body, #winamp {
        -webkit-app-region: drag;
        overflow: hidden;
    }
</style>
<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
</html>
