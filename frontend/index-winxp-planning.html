<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link id="css" rel="stylesheet" href="theme/WinXP/WinXP.css">
	</head>
	<body>
		<!-- ! All WinXP related options should be added via the Change Theme command, instead of being in the HTML -->
		<div class="window" id="chatWindow">
			<div class="title-bar">
				<div class="title-bar-text">Twitch Chat</div>
				<div class="title-bar-controls">
					<button aria-label="Minimize"></button>
					<button aria-label="Maximize"></button>
					<button aria-label="Close"></button>
				</div>				  
			</div>
			<div class="window-body">
				<div class="ui">
					<div id="recipent">To: AlgorithmicPolicyIndex &lt;AlgorithmicPolicyIndex@twitch.tv&gt; </div> <!-- Change based on which channel is active in settings.json -->
					<div id="sidebar">
						<ul>
							<li class="liItem">Start Camera</li>
							<li class="liItem">Start Talking</li>
							<!-- <li class="liItem">I want to...
								<ul>
									<li>Invite Someone to this Converstation</li>
									<li>Send a File or Photo</li>
									<li>Send E-mail</li>
									<li>Ask for Remote Assistance</li>
									<li>Make a Phone Call</li>
									<li>Start Application Sharing</li>
									<li>Start Whiteboard</li>
								</ul>
							</li> -->
						</ul>
					</div>
					<div class="messageBox">
						<ul id="history"></ul>
					</div>
					<div class="chatBox">
						<textarea></textarea>
						<button><u>S</u>end</button>
					</div>
					<!-- TODO: Status bar for Current Game -->
				</div>
			</div>
			<div class="status-bar">
				<p class="status-bar-field" id="curgame">
					Current Game: None - ChatPlays Offline!
				</p>
			</div>
		</div>

		<div id="brb">
			<div class="window">
				<div class="window-body">
					<div id="brb-text">Be right Back!</div>
				</div>
			</div>
		</div>
	</body>
	<script>
		let prevAuthor = "";
		let count = 0;

		function changeCSS(theme) {
			const oldCSS = document.getElementById("css");
			const newCSS = document.createElement("link");
			newCSS.setAttribute("rel", "stylesheet");
			newCSS.setAttribute("type", "text/css");
			newCSS.setAttribute("href", theme);

			document.getElementsByTagName("head").item(0).replaceChild(newCSS, oldCSS);
		}

		// TODO: Change Message Color when theme is active, based on exported function for color schemes via the theme.js
		function initializeMessage(user, mod, broadcaster, settings, message, channel) {
			// ? The whole message blob creation shit
			let historyBlob = document.createElement('li');
			historyBlob.setAttribute("id", user + count);
			historyBlob.setAttribute("style", "border-color: rgb(95, 95, 95);")
			let name = document.createElement("h2");
			name.setAttribute("id", "name");
			// ? Username
			if (broadcaster == "1") {
				name.setAttribute("style", `color: ${settings.broadcaster};`);
			} else if (mod) {
				name.setAttribute("style", `color: ${settings.moderator};`);
			} else {
				name.setAttribute("style", `color: ${settings.username};`);
			}
			name.innerHTML = `${mod ? "(mod) " + user : user} <span class='channel' style='color: ${settings.channel}'>- ${channel}</span>`;
			// ? First Message in Blob
			let initMsg = document.createElement("p");
			initMsg.setAttribute("id", "message");
			initMsg.setAttribute("style", `color: ${settings.message}`);
			initMsg.innerHTML = pingMessage(message);
			
			historyBlob.appendChild(name);
			historyBlob.appendChild(initMsg);
			
			// ? we have a message! append to list!
			document.getElementById("history").appendChild(historyBlob);

		}

		function blobHistory(maxblobs) {
			if (document.getElementById("history").childNodes.length >= maxblobs) {
				// ! I'm leaving this code comment here, just to show what I did because I was honestly stupid.
				// let deleteFrom = document.getElementById("history");
				// let fstmsg = document.getElementById(firstMessage);
				// deleteFrom.removeChild(fstmsg);
				// firstMessage = document.getElementById("history").childNodes[0].id;
				document.getElementById("history").removeChild(document.getElementById("history").childNodes[0]);
			}
		}

		function pingMessage(msg) {
			const list = msg.split(" ");
			for (const ping of list) {
				if (ping.includes("@")) {
					list[list.indexOf(ping)] = `<span id="ping" name="ping"><strong>${ping}</strong></span>`;
				}
			}
			return list.join(" ");
		}

		function colorPing(color) {
			let pingmsgs = document.getElementsByName("ping");
			for (let ping of pingmsgs) {
				if (ping) {
					ping.setAttribute("style", `color: ${color}`);
				}
			}
		}
	</script>
</html>